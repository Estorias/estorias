<!DOCTYPE html>
<html lang="pt-BR" data-theme="onenari">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Personagem Interativa (Jogador)</title> <link rel="icon" type="image/x-icon" href="img/logo.ico">
    <!-- Scripts do Firebase (versão atualizada) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="fp/style.css">

</head>
<body class="p-4 sm:p-6 md:p-8">

    <!-- Theme Switcher -->
    <div id="theme-switcher">
        <button id="theme-switcher-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
            </svg>
        </button>
        <div id="theme-switcher-menu">
            <div class="theme-option" data-theme="onenari">Onenari</div>
            <div class="theme-option" data-theme="klon">Klon</div>
            <div class="theme-option" data-theme="cineria">Cinéria</div>
            <div class="theme-option" data-theme="valver">Valver</div>
            <div class="theme-option" data-theme="echo">Echo</div>
        </div>
    </div>
    
    <!-- Floating Buttons Container -->
    <div class="floating-button-container">
        <button id="bulletin-board-toggle-button" class="floating-button" title="Quadro de Avisos">
            <span id="bulletin-notification-dot"></span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clipboard2-data-fill text-accent" viewBox="0 0 16 16">
                <path d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5"/>
                <path d="M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5M10 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-4 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1.5.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m2-3a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
            </svg>
        </button>
        <button id="open-map-button" class="floating-button" title="Abrir Mapa">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-map-fill text-accent" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.598-.49L10.5.99 5.598.01a.5.5 0 0 0-.196 0l-5 1A.5.5 0 0 0 0 1.5v14a.5.5 0 0 0 .598.49l4.902-.98 4.902.98a.5.5 0 0 0 .196 0l5-1A.5.5 0 0 0 16 14.5zM5 14.09V1.11l.5-.1.5.1v12.98l-1 .2zm5 0V1.11l.5-.1.5.1v12.98l-1 .2z"/>
            </svg>
        </button>
        <button id="chat-toggle-button" class="floating-button" title="Chat">
            <span id="chat-notification-dot"></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
        </button>
        <button id="gallery-button" class="floating-button" title="Galeria">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1h-6l-1-1z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M18 10a2 2 0 00-2-2h-1.333L14 7l-2 1-2-1-1.667 1H8a2 2 0 00-2 2v2a2 2 0 002 2h8a2 2 0 002-2v-2z" />
            </svg>
        </button>
        <button id="annotations-button" class="floating-button" title="Anotações">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
        </button>
    </div>

    <!-- Janela do CHAT -->
    <div id="chat-window" class="clipped hidden">
        <div id="chat-header">
            <h3>Chat da Sessão</h3>
            <button id="clear-chat-btn" title="Limpar histórico local">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input-container">
            <button id="custom-roll-btn" class="chat-action-btn" title="Rolagem Customizada">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M22 13.586v-3.172l-3.951-2.28c-.419-.242-.783-.663-1.002-1.123l1.58-4.394-2.771-2.771-4.394 1.58c-.46-.219-.881-.583-1.123-1.002L8.049 0H4.877L2.597 3.951c-.242.419-.663.783-1.123 1.002L0 6.533v3.172l3.951 2.28c.419.242.783.663 1.002 1.123l-1.58 4.394 2.771 2.771 4.394-1.58c.46.219.881.583 1.123 1.002l2.28 3.951h3.172l2.28-3.951c.242-.419-.663-.783-1.123-1.002l4.394-1.58 2.771-2.771-1.58-4.394c.219-.46.583-.881 1.002-1.123L22 13.586zM12 16c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/></svg>
            </button>
            <input type="text" id="chat-input" placeholder="Digite uma mensagem...">
            <button id="chat-send-btn" class="btn-primary">Enviar</button>
        </div>
    </div>
    
    <!-- Janela do Quadro de Avisos -->
    <div id="bulletin-board-window" class="modal-container shadow-2xl hidden clipped" style="resize: both; overflow: hidden;">
        <div class="interactive-window-header bg-tertiary p-2 flex justify-between items-center" style="border-bottom: 1px solid var(--color-border); flex-shrink: 0;">
            <h3 class="font-bold" style="color: var(--color-accent);">Quadro de Avisos</h3>
            <button class="interactive-window-close hover:text-primary" style="color: var(--color-text-secondary);">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="bulletin-board-messages" class="flex-grow overflow-y-auto p-4 space-y-4">
            <!-- As mensagens do quadro de avisos aparecerão aqui -->
        </div>
    </div>


    <!-- Modals -->
    <div id="roll-test-modal" class="modal-overlay">
        <div class="modal-container bg-secondary p-6 rounded-lg shadow-lg clipped max-w-sm text-center">
            <h3 id="roll-modal-title" class="font-condensed text-2xl text-accent mb-4">Rolar Teste?</h3>
            <p class="text-secondary mb-6">Como você gostaria de rolar o teste de atributo?</p>
            <div class="flex justify-center gap-4 mt-4">
                <button id="roll-normal-btn" class="btn-primary py-2 px-6 rounded-md">Normal (1d12)</button>
                <button id="roll-aptidao-btn" class="btn-secondary py-2 px-6 rounded-md">Aptidão (2d6)</button>
            </div>
        </div>
    </div>
    <div id="custom-roll-modal" class="modal-overlay">
        <div class="modal-container bg-secondary p-6 rounded-lg shadow-lg clipped max-w-sm text-center">
            <h3 class="font-condensed text-2xl text-accent mb-4">Rolagem Customizada</h3>
            <div class="mb-4">
                <label for="custom-roll-modifier" class="block text-sm font-medium text-secondary mb-2">Modificador</label>
                <input type="number" id="custom-roll-modifier" value="0" class="w-24 text-center text-xl font-bold rounded-md p-2">
            </div>
            <p class="text-secondary mb-6">Escolha o tipo de dado para a rolagem.</p>
            <div class="flex justify-center gap-4 mt-4">
                <button id="custom-roll-normal-btn" class="btn-primary py-2 px-6 rounded-md">Normal (1d12)</button>
                <button id="custom-roll-aptidao-btn" class="btn-secondary py-2 px-6 rounded-md">Aptidão (2d6)</button>
            </div>
        </div>
    </div>
    <div id="annotations-modal" class="modal-overlay">
        <div id="annotations-container" class="modal-container clipped">
            <div id="annotations-editor"></div>
        </div>
    </div>
    <div id="gallery-modal" class="modal-overlay">
        <div id="gallery-container" class="modal-container clipped">
            <div id="gallery-toolbar" class="flex items-center gap-2 p-2 border-b border-color">
                <div class="flex-grow">
                    <nav class="-mb-px flex space-x-2">
                        <button onclick="switchGalleryTab(event, 'gallery-main-content')" class="gallery-tab-button active">Galeria</button>
                        <button onclick="switchGalleryTab(event, 'stickers-main-content')" class="gallery-tab-button">Figurinhas</button>
                    </nav>
                </div>
                <button onclick="closeGallery()" class="btn-secondary p-2 text-sm ml-auto">Fechar</button>
            </div>
            
            <div id="gallery-main-content" class="gallery-tab-content active">
                <div class="p-2 border-b border-color flex-shrink-0">
                    <button onclick="document.getElementById('gallery-upload-input').click()" class="btn-secondary p-2 text-sm">Adicionar Arquivo</button>
                    <input type="file" id="gallery-upload-input" class="hidden" accept="image/*" multiple onchange="handleGalleryUpload(event)">
                    <button onclick="handleGalleryUrlAdd()" class="btn-secondary p-2 text-sm">Adicionar por URL</button>
                </div>
                <div id="gallery-content" class="flex-grow overflow-y-auto p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- Gallery items will be injected here -->
                </div>
            </div>

            <div id="stickers-main-content" class="gallery-tab-content">
                <div class="p-2 border-b border-color flex-shrink-0">
                    <button onclick="document.getElementById('sticker-upload-input').click()" class="btn-primary p-2 text-sm">Carregar Figurinha</button>
                    <input type="file" id="sticker-upload-input" class="hidden" accept="image/*,image/gif" onchange="handleStickerUpload(event)">
                </div>
                <div id="stickers-content" class="flex-grow overflow-y-auto p-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- Stickers will be injected here -->
                </div>
            </div>
        </div>
    </div>
    <div id="gallery-lightbox" class="modal-overlay" onclick="closeLightbox(event)">
        <button onclick="closeLightbox(event)" class="absolute top-4 right-4 text-white text-5xl font-bold">&times;</button>
        <img id="lightbox-image" src="" class="max-w-full max-h-full rounded-lg" style="max-height: 90vh;">
    </div>
    <div id="gallery-url-modal" class="modal-overlay">
        <div class="modal-container bg-secondary p-5 rounded-lg shadow-lg clipped max-w-md">
            <h3 class="font-condensed text-xl text-accent mb-4">Adicionar Imagem por URL</h3>
            <p class="text-secondary mb-2 text-sm">Por favor, insira a URL completa da imagem.</p>
            <input type="text" id="gallery-url-input" class="w-full p-2 rounded-md" placeholder="https://...">
            <div class="flex justify-end gap-4 mt-4">
                <button onclick="closeUrlModal()" class="btn-secondary py-2 px-4 rounded-md">Cancelar</button>
                <button onclick="submitUrlModal()" class="btn-primary py-2 px-4 rounded-md">Adicionar</button>
            </div>
        </div>
    </div>

    <!-- MAP MODAL -->
    <div id="map-modal">
        <div id="map-toolbar">
            <span class="text-secondary font-semibold">Mapa da Sessão</span>
            <button id="close-map-btn" class="btn-secondary text-sm px-4 py-2 ml-auto">Fechar</button>
        </div>
        <div id="map-viewport">
            <div id="map-container">
                <div id="map-grid"></div>
                <div id="map-tokens"></div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto">
        <!-- Cabeçalho com Nome e Botões Salvar/Carregar -->
        <header class="mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex-grow">
                    <label for="char-name" class="block text-sm font-medium text-secondary">Nome do Personagem</label>
                    <input type="text" id="char-name" placeholder="Digite o nome aqui..." class="mt-1 block w-full rounded-md shadow-sm py-3 px-4 text-2xl font-bold focus:outline-none clipped">
                </div>
                <div class="flex-shrink-0 flex items-center gap-2">
                    <button onclick="saveSheet()" class="btn-primary py-2 px-4 rounded-md transition-colors text-sm">Salvar</button>
                    <button onclick="document.getElementById('load-sheet-input').click()" class="btn-secondary py-2 px-4 rounded-md transition-colors text-sm">Carregar</button>
                    <input type="file" id="load-sheet-input" class="hidden" accept=".json" onchange="loadSheet(event)">
                </div>
            </div>
        </header>

        <!-- Seção Superior Fixa: Foto, Atributos, Vigor e Estresse -->
        <section id="fixed-stats" class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">
            <!-- Foto e Atributos Combinados -->
            <div class="lg:col-span-3 bg-secondary p-5 rounded-lg shadow-lg flex flex-col sm:flex-row items-center sm:items-start gap-6 clipped">
                <!-- Moldura da Foto -->
                <div class="flex-shrink-0 flex flex-col items-center">
                    <label for="image-upload" class="cursor-pointer">
                        <div id="image-preview-container" class="relative w-32 h-32 rounded-full border-4 bg-tertiary flex items-center justify-center overflow-hidden transition-colors">
                            <img id="image-preview" src="" class="w-full h-full" alt="Foto do Personagem">
                            <span id="image-placeholder" class="absolute text-secondary text-center text-sm p-2">Adicionar Foto</span>
                        </div>
                    </label>
                    <input type="file" id="image-upload" class="hidden" accept="image/*">
                    <button onclick="document.getElementById('image-upload').click()" class="mt-4 btn-primary py-2 px-3 rounded-md text-sm">
                        Enviar Imagem
                    </button>
                </div>
                
                <!-- Atributos -->
                <div class="flex-grow w-full">
                    <h2 class="font-condensed text-xl text-accent border-b border-color pb-2 mb-4 text-center sm:text-left">ATRIBUTOS</h2>
                    <div class="grid grid-cols-2 gap-x-6 gap-y-3">
                        <!-- Físicos -->
                        <div class="space-y-3">
                             <h3 class="font-semibold text-lg text-primary">Físicos</h3>
                            <div class="flex items-center justify-between">
                                <label id="label-destreza" for="destreza" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Destreza <span id="destreza-indicator"></span></label>
                                <input type="number" id="destreza" value="0" class="w-14 text-center rounded-md">
                            </div>
                            <div class="flex items-center justify-between">
                                <label id="label-forca" for="forca" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Força <span id="forca-indicator"></span></label>
                                <input type="number" id="forca" value="0" class="w-14 text-center rounded-md">
                            </div>
                            <div class="flex items-center justify-between">
                                <label id="label-fortitude" for="fortitude" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Fortitude <span id="fortitude-indicator"></span></label>
                                <input type="number" id="fortitude" value="0" oninput="updateMaxVigor()" class="w-14 text-center rounded-md">
                            </div>
                        </div>
                        <!-- Mentais -->
                        <div class="space-y-3">
                            <h3 class="font-semibold text-lg text-primary">Mentais</h3>
                            <div class="flex items-center justify-between">
                                <label id="label-discernimento" for="discernimento" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Discernimento <span id="discernimento-indicator"></span></label>
                                <input type="number" id="discernimento" value="0" class="w-14 text-center rounded-md">
                            </div>
                            <div class="flex items-center justify-between">
                                <label id="label-criatividade" for="criatividade" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Criatividade <span id="criatividade-indicator"></span></label>
                                <input type="number" id="criatividade" value="0" class="w-14 text-center rounded-md">
                            </div>
                            <div class="flex items-center justify-between">
                                <label id="label-vontade" for="vontade" class="font-medium flex items-center gap-2 cursor-pointer hover:text-accent">Vontade <span id="vontade-indicator"></span></label>
                                <input type="number" id="vontade" value="0" class="w-14 text-center rounded-md">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vigor e Estresse -->
            <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="bg-secondary p-5 rounded-lg shadow-lg text-center flex flex-col justify-center clipped">
                    <div class="flex justify-center items-baseline gap-2">
                        <h2 class="font-condensed text-xl text-accent">VIGOR</h2>
                    </div>
                    <div class="w-full flex items-center gap-2 mt-2">
                        <button onclick="updateValue('vigor', -1)" class="btn-minus font-bold w-8 h-8 rounded-full transition-colors flex-shrink-0">-</button>
                        <div id="vigor-bar-bg" class="w-full h-8 bg-tertiary rounded-full relative overflow-hidden border border-color">
                            <div id="vigor-bar-fill" class="h-full rounded-full transition-all duration-300"></div>
                            <span id="vigor-text" class="absolute inset-0 flex items-center justify-center font-bold text-white" style="text-shadow: 1px 1px 2px black;">0 / 0</span>
                        </div>
                        <button onclick="updateValue('vigor', 1)" class="btn-plus font-bold w-8 h-8 rounded-full transition-colors flex-shrink-0">+</button>
                    </div>
                    <input type="hidden" id="vigor" value="0">
                    <span class="text-sm text-secondary mt-1">(Max: <span id="vigor-max">0</span>)</span>
                </div>
                <div class="bg-secondary p-5 rounded-lg shadow-lg text-center flex flex-col justify-center clipped">
                    <h2 class="font-condensed text-xl text-accent mb-2">ESTRESSE</h2>
                    <div class="flex items-center justify-center space-x-2">
                        <button onclick="updateValue('estresse', -1)" class="btn-minus font-bold w-8 h-8 rounded-full transition-colors">-</button>
                        <input type="number" id="estresse" value="0" class="w-20 text-center text-2xl font-bold rounded-md p-2">
                        <button onclick="updateValue('estresse', 1)" class="btn-plus font-bold w-8 h-8 rounded-full transition-colors">+</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção Principal com Abas de Cena -->
        <main id="cena-section">
            <!-- Abas -->
            <div class="border-b border-color mb-6">
                <nav class="-mb-px flex space-x-4" aria-label="Cena">
                    <button onclick="switchMainTab(event, 'interpretacao')" class="main-tab-button active text-lg font-condensed whitespace-nowrap py-3 px-5 border-b-4 border-transparent font-medium text-secondary">INTERPRETAÇÃO</button>
                    <button onclick="switchMainTab(event, 'confronto')" class="main-tab-button text-lg font-condensed whitespace-nowrap py-3 px-5 border-b-4 border-transparent font-medium text-secondary">CONFRONTO</button>
                </nav>
            </div>

            <!-- Conteúdo das Abas -->
            <div id="interpretacao" class="main-tab-content active">
                 <!-- Conteúdo preenchido via JS -->
            </div>
            <div id="confronto" class="main-tab-content">
                <!-- Conteúdo preenchido via JS -->
            </div>
        </main>
    </div>
<div id="firebase-config-modal" class="modal-overlay" style="display: none; z-index: 200;">
    <div class="modal-container bg-secondary p-6 rounded-lg shadow-lg clipped max-w-md w-full">
        <h3 class="font-condensed text-2xl text-accent mb-2 text-center">Conectar ao Jogo</h3>
        <p class="text-secondary mb-6 text-sm text-center">Insira a chave de acesso para sincronizar.</p>
        
        <button onclick="document.getElementById('load-key-input-login').click()" class="btn-secondary w-full mb-4 flex items-center justify-center gap-2 py-3 border border-dashed border-color hover:border-accent transition-colors rounded-md">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
            </svg>
            Carregar Chave (.json)
        </button>
        <input type="file" id="load-key-input-login" class="hidden" accept=".json" onchange="handleKeyFileSelect(event)">

        <div class="relative flex py-2 items-center mb-4">
            <div class="flex-grow border-t border-color"></div>
            <span class="flex-shrink-0 mx-4 text-xs font-bold text-secondary">OU MANUALMENTE</span>
            <div class="flex-grow border-t border-color"></div>
        </div>
        
        <div class="space-y-3">
            <div>
                <label class="text-xs text-secondary">API Key</label>
                <input type="text" id="fb-apiKey" class="w-full p-2 rounded-md text-sm" placeholder="AIzaSy...">
            </div>
            <div>
                <label class="text-xs text-secondary">Auth Domain</label>
                <input type="text" id="fb-authDomain" class="w-full p-2 rounded-md text-sm" placeholder="projeto.firebaseapp.com">
            </div>
            <div>
                <label class="text-xs text-secondary">Project ID</label>
                <input type="text" id="fb-projectId" class="w-full p-2 rounded-md text-sm" placeholder="id-do-projeto">
            </div>
            <div class="grid grid-cols-2 gap-2">
                <div>
                    <label class="text-xs text-secondary">Storage Bucket</label>
                    <input type="text" id="fb-storageBucket" class="w-full p-2 rounded-md text-sm">
                </div>
                <div>
                    <label class="text-xs text-secondary">Messaging Sender ID</label>
                    <input type="text" id="fb-messagingSenderId" class="w-full p-2 rounded-md text-sm">
                </div>
            </div>
            <div>
                <label class="text-xs text-secondary">App ID</label>
                <input type="text" id="fb-appId" class="w-full p-2 rounded-md text-sm">
            </div>
        </div>

        <div class="flex justify-center gap-4 mt-6">
            <button onclick="saveAndConnectFirebase()" class="btn-primary py-2 px-6 rounded-md w-full">Conectar</button>
        </div>
         <p class="text-xs text-secondary mt-2 text-center cursor-pointer hover:text-red-400" onclick="clearFirebaseConfig()">Limpar dados salvos</p>
    </div>
</div>
    <!-- Cropper Modal -->
    <div id="cropper-modal" class="modal-overlay">
        <div class="modal-container bg-secondary rounded-lg shadow-xl w-full max-w-lg p-6">
            <h3 class="text-xl font-semibold mb-4 text-primary">Ajustar Imagem</h3>
            <div class="w-full h-64 md:h-80 mb-4 bg-primary">
                <img id="image-to-crop" src="">
            </div>
            <div class="flex justify-end space-x-4">
                <button id="cancel-crop-btn" class="btn-secondary px-4 py-2 rounded-md">Cancelar</button>
                <button id="crop-and-save-btn" class="btn-primary px-4 py-2 rounded-md">Cortar e Salvar</button>
            </div>
        </div>
    </div>
    
    <!-- Sticker Context Menu -->
    <div id="sticker-context-menu" class="hidden fixed z-[200] bg-secondary border border-color rounded-md shadow-lg py-1 w-32">
        <button id="sticker-remove-btn" class="block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-tertiary">Remover</button>
    </div>

    <!-- Cropper.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <!-- Quill.js JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="fp/script.js"></script>
</body>
</html>


