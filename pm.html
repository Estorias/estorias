<!DOCTYPE html>
<html lang="pt-BR" data-theme="cineria">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Mestre - Campanha</title> <link rel="icon" type="image/x-icon" href="img/logo.ico">
    <!-- Scripts do Firebase (versão atualizada) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Bibliotecas JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="pm/style.css">
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-screen-2xl mx-auto">
        <header class="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div>
                <h1 class="text-4xl font-bold font-condensed" style="color: var(--color-accent);">Painel de Controle da Campanha</h1>
                <p style="color: var(--color-text-secondary);">Gerencie NPCs, Bestiário, Eventos e mais.</p>
            </div>
            <div class="flex-shrink-0 flex items-center gap-2">
                 <select id="theme-selector" class="btn btn-secondary" title="Mudar Tema"></select>
                 <button onclick="saveAllToJson()" class="btn btn-primary">Gravar Campanha</button>
                 <button onclick="document.getElementById('load-json-input').click()" class="btn btn-secondary">Carregar Fichas (JSON)</button>
                 <input type="file" id="load-json-input" class="hidden" accept=".json" onchange="loadAllFromJson(event)">
            </div>
        </header>

        <nav class="border-b mb-6" style="border-color: var(--color-border);">
            <div class="-mb-px flex space-x-4" aria-label="Abas">
                <button onclick="switchTab(event, 'npcs')" class="main-tab-button active text-lg font-condensed py-3 px-5 border-b-4 border-transparent">NPCs</button>
                <button onclick="switchTab(event, 'bestiario')" class="main-tab-button text-lg font-condensed py-3 px-5 border-b-4 border-transparent">Bestiário</button>
                <button onclick="switchTab(event, 'eventos')" class="main-tab-button text-lg font-condensed py-3 px-5 border-b-4 border-transparent">Eventos</button>
                <button onclick="switchTab(event, 'anotacoes')" class="main-tab-button text-lg font-condensed py-3 px-5 border-b-4 border-transparent">Anotações</button>
                <button onclick="switchTab(event, 'galeria')" class="main-tab-button text-lg font-condensed py-3 px-5 border-b-4 border-transparent">Galeria</button>
            </div>
        </nav>

        <main>
            <!-- Conteúdo das Abas -->
            <div id="npcs" class="main-tab-content active"></div>
            <div id="bestiario" class="main-tab-content"></div>
            <div id="eventos" class="main-tab-content"></div>
            <div id="anotacoes" class="main-tab-content"></div>
            <div id="galeria" class="main-tab-content">
                 <div class="border-b flex items-center justify-between p-2" style="border-color: var(--color-border);">
                    <nav class="flex space-x-2">
                        <button onclick="switchGalleryTab(event, 'gallery-main-content')" class="gallery-tab-button active">Galeria</button>
                        <button onclick="switchGalleryTab(event, 'stickers-main-content')" class="gallery-tab-button">Figurinhas</button>
                    </nav>
                </div>

                <!-- Aba Principal da Galeria com Pastas -->
                <div id="gallery-main-content" class="gallery-tab-content active">
                    <div class="grid grid-cols-12 gap-4 h-full">
                        <!-- Coluna de Pastas -->
                        <div class="col-span-3 bg-secondary rounded-lg p-2 flex flex-col">
                            <h3 class="text-lg font-bold p-2" style="color: var(--color-accent);">Pastas</h3>
                            <div id="gallery-folders-list" class="flex-grow overflow-y-auto pr-1">
                                <!-- Lista de pastas aqui -->
                            </div>
                            <button onclick="openFolderModal('add')" class="btn btn-primary w-full mt-2 text-sm">Nova Pasta</button>
                        </div>
                        <!-- Coluna de Imagens -->
                        <div class="col-span-9 bg-secondary rounded-lg p-2 flex flex-col">
                            <div class="flex items-center gap-2 p-2 border-b mb-2" style="border-color: var(--color-border);">
                                <h3 id="gallery-current-folder-name" class="text-lg font-bold" style="color: var(--color-accent);">Geral</h3>
                                <div class="ml-auto flex items-center gap-2">
                                    <button onclick="document.getElementById('gallery-upload-input').click()" class="btn btn-secondary text-sm">Adicionar Imagem</button>
                                    <input type="file" id="gallery-upload-input" class="hidden" accept="image/*" multiple onchange="handleGalleryUpload(event)">
                                    <button onclick="handleGalleryUrlAdd()" class="btn btn-secondary text-sm">Adicionar por URL</button>
                                </div>
                            </div>
                            <div id="gallery-images-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 overflow-y-auto p-2">
                                <!-- Imagens da pasta selecionada aqui -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba de Figurinhas -->
                <div id="stickers-main-content" class="gallery-tab-content">
                    <div class="bg-secondary rounded-lg p-2 flex flex-col h-full">
                        <div class="flex items-center gap-2 p-2 border-b mb-2" style="border-color: var(--color-border);">
                             <h3 class="text-lg font-bold" style="color: var(--color-accent);">Figurinhas</h3>
                             <button onclick="document.getElementById('sticker-upload-input').click()" class="btn btn-primary text-sm ml-auto">Carregar Figurinha</button>
                             <input type="file" id="sticker-upload-input" class="hidden" accept="image/*,image/gif" onchange="handleStickerUpload(event)">
                        </div>
                         <div id="stickers-content" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 xl:grid-cols-6 gap-4 overflow-y-auto p-2">
                            <!-- Figurinhas aqui -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="cropper-modal" class="modal-overlay">
        <div class="modal-container rounded-lg shadow-xl w-full max-w-lg p-6">
            <h3 class="text-xl font-semibold mb-4">Ajustar Imagem</h3>
            <div class="w-full h-64 md:h-80 mb-4 bg-tertiary">
                <img id="image-to-crop" src="">
            </div>
            <div class="flex justify-end space-x-4">
                <button id="cancel-crop-btn" class="btn btn-secondary">Cancelar</button>
                <button id="crop-and-save-btn" class="btn btn-primary">Cortar e Salvar</button>
            </div>
        </div>
    </div>
    
    <div id="clear-chat-modal" class="modal-overlay">
        <div class="modal-container p-6 rounded-lg shadow-lg max-w-sm text-center">
            <h3 class="font-condensed text-2xl mb-4" style="color: var(--color-accent);">Limpar Histórico do Chat?</h3>
            <p class="mb-6" style="color: var(--color-text-secondary);">Esta ação não pode ser desfeita.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-4">
                <button id="clear-chat-local-btn" class="btn btn-secondary">Apenas para Mim</button>
                <button id="clear-chat-all-btn" class="btn btn-danger">Para Todos</button>
            </div>
             <button id="clear-chat-cancel-btn" class="hover:text-primary mt-6 text-sm bg-transparent border-none" style="color: var(--color-text-secondary);">Cancelar</button>
        </div>
    </div>

    <div id="clear-bulletin-modal" class="modal-overlay">
        <div class="modal-container p-6 rounded-lg shadow-lg max-w-sm text-center">
            <h3 class="font-condensed text-2xl mb-4" style="color: var(--color-accent);">Limpar Quadro de Avisos?</h3>
            <p class="mb-6" style="color: var(--color-text-secondary);">Todas as mensagens e imagens serão permanentemente apagadas. Esta ação não pode ser desfeita.</p>
            <div class="flex justify-center gap-4 mt-4">
                <button id="clear-bulletin-cancel-btn" class="btn btn-secondary">Cancelar</button>
                <button id="clear-bulletin-confirm-btn" class="btn btn-danger">Limpar Tudo</button>
            </div>
        </div>
    </div>

    <div id="custom-roll-modal" class="modal-overlay">
        <div class="modal-container p-6 rounded-lg shadow-lg max-w-sm text-center">
            <h3 class="font-condensed text-2xl mb-4" style="color: var(--color-accent);">Rolagem Customizada</h3>
            <div class="mb-4">
                <label for="custom-roll-modifier" class="block text-sm font-medium mb-2" style="color: var(--color-text-secondary);">Modificador</label>
                <input type="number" id="custom-roll-modifier" value="0" class="w-24 text-center text-xl font-bold rounded-md p-2">
            </div>
            <p class="mb-6" style="color: var(--color-text-secondary);">Escolha o tipo de dado para a rolagem.</p>
            <div class="flex justify-center gap-4 mt-4">
                <button id="custom-roll-normal-btn" class="btn btn-primary py-2 px-6">Normal (1d12)</button>
                <button id="custom-roll-aptidao-btn" class="btn btn-secondary py-2 px-6">Aptidão (2d6)</button>
            </div>
        </div>
    </div>

     <div id="attribute-roll-modal" class="modal-overlay">
        <div class="modal-container p-6 rounded-lg shadow-lg max-w-sm text-center">
            <h3 id="attribute-roll-modal-title" class="font-condensed text-2xl mb-4" style="color: var(--color-accent);">Rolar Teste?</h3>
            <p class="mb-6" style="color: var(--color-text-secondary);">Como você gostaria de rolar o teste de atributo?</p>
            <div class="flex justify-center gap-4 mt-4">
                <button id="attribute-roll-normal-btn" class="btn btn-primary py-2 px-6">Normal (1d12)</button>
                <button id="attribute-roll-aptidao-btn" class="btn btn-secondary py-2 px-6">Aptidão (2d6)</button>
            </div>
        </div>
    </div>
    
    <!-- JANELAS INTERATIVAS (HABILIDADES, EVENTOS, ANOTACOES) -->
    <div id="skills-window" class="modal-container shadow-2xl resize overflow-hidden">
        <div class="interactive-window-header bg-tertiary p-2 flex justify-between items-center" style="border-bottom: 1px solid var(--color-border);">
            <h3 id="skills-window-title" class="font-bold" style="color: var(--color-accent);">Habilidades</h3>
            <div class="flex items-center gap-2">
                <button class="interactive-window-maximize hover:text-primary" style="color: var(--color-text-secondary);">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4h4m12 4V4h-4M4 16v4h4m12-4v4h-4"></path></svg>
                </button>
                <button class="interactive-window-close hover:text-primary" style="color: var(--color-text-secondary);">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>
        <div class="interactive-window-content">
             <div style="border-bottom: 1px solid var(--color-border);">
                <nav class="-mb-px flex space-x-2" aria-label="Skills Tabs">
                    <button onclick="switchSubTab(event, 'habilidades-tab')" class="sub-tab-button active whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm rounded-t-md" style="color: var(--color-text-secondary);">Habilidades</button>
                    <button onclick="switchSubTab(event, 'confronto-tab')" class="sub-tab-button whitespace-nowrap py-2 px-3 border-b-2 border-transparent font-medium text-sm rounded-t-md" style="color: var(--color-text-secondary);">Confronto</button>
                </nav>
            </div>
            <div id="habilidades-tab" class="sub-tab-content active p-1"><div id="quill-editor"></div></div>
            <div id="confronto-tab" class="sub-tab-content h-full overflow-y-auto p-4">
                <section class="mb-4">
                    <h3 class="font-condensed text-lg border-b pb-1 mb-2" style="color: var(--color-accent); border-color: var(--color-border);">EFEITOS ATIVOS</h3>
                    <div id="active-effects-display" class="space-y-2 text-sm">
                         <p class="italic" style="color: var(--color-text-secondary);">Nenhum efeito ativo.</p>
                    </div>
                </section>
                <section>
                    <h3 class="font-condensed text-lg border-b pb-1 mb-2" style="color: var(--color-accent); border-color: var(--color-border);">SELECIONAR CONDIÇÕES</h3>
                    <div id="conditions-checklist" class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm"></div>
                </section>
            </div>
        </div>
    </div>
    
    <!-- MODAIS DA GALERIA -->
    <div id="gallery-lightbox" class="modal-overlay" onclick="closeLightbox(event)">
        <button onclick="closeLightbox(event)" class="absolute top-4 right-4 text-white text-5xl font-bold">&times;</button>
        <img id="lightbox-image" src="" class="max-w-full max-h-full rounded-lg" style="max-height: 90vh;">
    </div>
     <div id="gallery-url-modal" class="modal-overlay">
        <div class="modal-container p-5 rounded-lg shadow-lg max-w-md">
            <h3 class="font-condensed text-xl mb-4" style="color: var(--color-accent);">Adicionar Imagem por URL</h3>
            <p class="mb-2 text-sm" style="color: var(--color-text-secondary);">Por favor, insira a URL completa da imagem.</p>
            <input type="text" id="gallery-url-input" class="w-full p-2 rounded-md" placeholder="https://...">
            <div class="flex justify-end gap-4 mt-4">
                <button onclick="document.getElementById('gallery-url-modal').style.display = 'none'" class="btn btn-secondary py-2 px-4">Cancelar</button>
                <button onclick="submitUrlModal()" class="btn btn-primary py-2 px-4">Adicionar</button>
            </div>
        </div>
    </div>
     <div id="folder-modal" class="modal-overlay">
        <div class="modal-container p-5 rounded-lg shadow-lg max-w-md">
            <h3 id="folder-modal-title" class="font-condensed text-xl mb-4" style="color: var(--color-accent);">Nova Pasta</h3>
            <input type="text" id="folder-name-input" class="w-full p-2 rounded-md" placeholder="Nome da pasta...">
             <input type="hidden" id="folder-modal-id">
             <input type="hidden" id="folder-modal-mode">
            <div class="flex justify-end gap-4 mt-4">
                <button onclick="document.getElementById('folder-modal').style.display = 'none'" class="btn btn-secondary py-2 px-4">Cancelar</button>
                <button onclick="handleSaveFolder()" class="btn btn-primary py-2 px-4">Salvar</button>
            </div>
        </div>
    </div>
     <div id="gallery-context-menu">
        <!-- Itens do menu serão adicionados dinamicamente -->
    </div>
    
    <!-- Janela do Quadro de Avisos -->
    <div id="bulletin-board-window" class="modal-container shadow-2xl hidden" style="position: fixed; top: 15%; left: 30%; width: 600px; height: 70vh; min-width: 450px; min-height: 400px; display: none; flex-direction: column; resize: both; overflow: auto;">
        <div class="interactive-window-header bg-tertiary p-2 flex justify-between items-center" style="border-bottom: 1px solid var(--color-border); flex-shrink: 0;">
            <h3 class="font-bold" style="color: var(--color-accent);">Quadro de Avisos</h3>
            <div class="flex items-center gap-2">
                 <button id="open-clear-bulletin-btn" class="hover:text-primary p-1" style="color: var(--color-text-secondary);" title="Limpar Quadro de Avisos">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </button>
                 <button id="show-bulletin-btn" class="btn btn-primary text-sm py-1 px-3">Mostrar para Players</button>
                 <button class="interactive-window-close hover:text-primary" style="color: var(--color-text-secondary);">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
        </div>
        <div id="bulletin-board-messages" class="flex-grow overflow-y-auto p-4 space-y-4">
            <!-- As mensagens do quadro de avisos aparecerão aqui -->
        </div>
        <div id="bulletin-board-input-container" class="border-t p-2 flex items-center gap-2" style="border-color: var(--color-border); flex-shrink: 0;">
            <textarea id="bulletin-board-input" class="w-full p-2 rounded-md h-12" placeholder="Escreva um aviso..."></textarea>
            <input type="file" id="bulletin-image-upload" class="hidden" accept="image/*">
            <button onclick="document.getElementById('bulletin-image-upload').click()" class="btn btn-secondary p-2" title="Anexar Imagem">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/><path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/></svg>
            </button>
            <button id="bulletin-send-btn" class="btn btn-primary">Enviar</button>
        </div>
    </div>


    <!-- Botões Flutuantes -->
    <div class="floating-button-container">
        <button onclick="window.open('mp.html', '_blank')" class="floating-button" title="Abrir Mapa">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-map-fill" viewBox="0 0 16 16" style="color: var(--color-accent);">
                <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0-.5.5v3.26a.5.5 0 0 1-.5.5H6a.5.5 0 0 1-.5-.5V.5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0-.5.5v5.618c0 .818.393 1.544 1 2v4.722c0 .546.29 1.059.75 1.357a.5.5 0 0 0 .5-.866A1.5 1.5 0 0 1 2 12.34v-4.722c.607-.456 1-1.182 1-2v-5.618h4v3.26a1.5 1.5 0 0 0 1.5 1.5h3.5a1.5 1.5 0 0 0 1.5-1.5V.5h4v5.618c0 .818-.393 1.544-1 2v4.722c0 .546-.29 1.059-.75 1.357a.5.5 0 0 0 .5.866A1.5 1.5 0 0 1 14 12.34v-4.722c-.607-.456-1-1.182-1-2V.5z"/>
            </svg>
        </button>
        <!-- NOVO BOTÃO DE CONFIG -->
        <button id="config-button" class="floating-button" title="Configurações da Mesa">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-gear-fill" style="color: var(--color-accent);" viewBox="0 0 16 16">
              <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413-1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.858 2.929 2.929 0 0 1 0 5.858z"/>
            </svg>
        </button>

        <button id="bulletin-board-toggle-button" class="floating-button" title="Quadro de Avisos">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clipboard2-data-fill" style="color: var(--color-accent);" viewBox="0 0 16 16">
                <path d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5"/>
                <path d="M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5M10 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-4 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1.5.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m2-3a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
            </svg>
        </button>
        <!-- BOTÃO MODIFICADO: Abre dm.html em nova aba -->
        <button onclick="window.open('dm.html', '_blank')" class="floating-button" title="Abrir Gerenciador de Combate (Nova Aba)">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-check-fill" style="color: var(--color-accent);" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            </svg>
        </button>
        <button id="chat-toggle-button" class="floating-button" title="Chat">
            <span id="chat-notification-dot"></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" style="color: var(--color-accent);" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
        </button>
    </div>

    <!-- Janela do Chat -->
    <div id="chat-window" class="hidden">
        <div id="chat-header">
            <h3 class="flex-grow">Chat da Sessão</h3>
            <button id="open-clear-chat-btn" class="hover:text-primary p-1" style="color: var(--color-text-secondary);" title="Limpar Chat">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input-container">
             <button id="custom-roll-btn" class="chat-action-btn" title="Rolagem Customizada">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M22 13.586v-3.172l-3.951-2.28c-.419-.242-.783-.663-1.002-1.123l1.58-4.394-2.771-2.771-4.394 1.58c-.46-.219-.881-.583-1.123-1.002L8.049 0H4.877L2.597 3.951c-.242.419-.663.783-1.123 1.002L0 6.533v3.172l3.951 2.28c.419.242.783.663 1.002 1.123l-1.58 4.394 2.771 2.771 4.394-1.58c.46.219.881.583 1.123 1.002l2.28 3.951h3.172l2.28-3.951c.242-.419-.663-.783-1.123-1.002l4.394-1.58 2.771-2.771-1.58-4.394c.219-.46.583-.881 1.002-1.123L22 13.586zM12 16c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/></svg>
            </button>
            <input type="text" id="chat-input" placeholder="Digite como Mestre...">
            <button id="chat-send-btn" class="btn btn-primary">Enviar</button>
        </div>
    </div>
    
    <!-- Painel do Mestre (REMOVIDO: Conteúdo antigo foi deletado para limpar o código) -->
    <!-- Se quiser o painel lateral de volta, use o código antigo. Agora o botão abre dm.html -->

    <!-- NOVO: MODAL DE LOGIN DO FIREBASE (igual do fp.html) -->
   <div id="firebase-config-modal" class="modal-overlay" style="display: none; z-index: 200;">
        <div class="modal-container bg-secondary p-6 rounded-lg shadow-lg max-w-md w-full">
            <h3 class="font-condensed text-2xl mb-2 text-center" style="color: var(--color-accent);">Importar Banco de Dados</h3>
            <p class="mb-6 text-sm text-center" style="color: var(--color-text-secondary);">Conecte-se para sincronizar o VTT.</p>
            
            <button onclick="document.getElementById('load-key-input-login').click()" class="btn btn-secondary w-full mb-4 flex items-center justify-center gap-2 py-3 border border-dashed" style="border-color: var(--color-accent);">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                    <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                </svg>
                Carregar Chave da Mesa (.json)
            </button>
            <input type="file" id="load-key-input-login" class="hidden" accept=".json" onchange="loadTableKey(event)">

            <div class="relative flex py-2 items-center mb-4">
                <div class="flex-grow border-t" style="border-color: var(--color-border);"></div>
                <span class="flex-shrink-0 mx-4 text-xs font-bold" style="color: var(--color-text-secondary);">OU MANUALMENTE</span>
                <div class="flex-grow border-t" style="border-color: var(--color-border);"></div>
            </div>
            
            <div class="space-y-3">
                <div>
                    <label class="text-xs" style="color: var(--color-text-secondary);">API Key</label>
                    <input type="text" id="fb-apiKey" class="w-full p-2 rounded-md text-sm" placeholder="AIzaSy...">
                </div>
                <div>
                    <label class="text-xs" style="color: var(--color-text-secondary);">Auth Domain</label>
                    <input type="text" id="fb-authDomain" class="w-full p-2 rounded-md text-sm" placeholder="projeto.firebaseapp.com">
                </div>
                <div>
                    <label class="text-xs" style="color: var(--color-text-secondary);">Project ID</label>
                    <input type="text" id="fb-projectId" class="w-full p-2 rounded-md text-sm" placeholder="id-do-projeto">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-xs" style="color: var(--color-text-secondary);">Storage Bucket</label>
                        <input type="text" id="fb-storageBucket" class="w-full p-2 rounded-md text-sm">
                    </div>
                    <div>
                        <label class="text-xs" style="color: var(--color-text-secondary);">Messaging Sender ID</label>
                        <input type="text" id="fb-messagingSenderId" class="w-full p-2 rounded-md text-sm">
                    </div>
                </div>
                <div>
                    <label class="text-xs" style="color: var(--color-text-secondary);">App ID</label>
                    <input type="text" id="fb-appId" class="w-full p-2 rounded-md text-sm">
                </div>
            </div>

            <div class="flex justify-center gap-4 mt-6">
                <button onclick="saveAndConnectFirebase()" class="btn btn-primary py-2 px-6 rounded-md w-full">Conectar</button>
            </div>
             <p class="text-xs mt-2 text-center cursor-pointer hover:text-red-400" style="color: var(--color-text-secondary);" onclick="clearFirebaseConfig()">Limpar dados salvos</p>
        </div>
    </div>

    <!-- NOVO: MODAL DE CONFIGURAÇÕES DA MESA -->
    <div id="config-modal" class="modal-overlay" style="display: none; z-index: 190;">
        <div class="modal-container p-6 rounded-lg shadow-lg max-w-sm w-full text-center">
            <h3 class="font-condensed text-2xl mb-6" style="color: var(--color-accent);">Configurações da Mesa</h3>
            
            <div class="space-y-4">
                <button onclick="generateTableKey()" class="btn btn-primary w-full">Gerar Chave da Mesa (JSON)</button>
                <button onclick="document.getElementById('load-key-input').click()" class="btn btn-secondary w-full">Entrar na Mesa (Carregar JSON)</button>
                <input type="file" id="load-key-input" class="hidden" accept=".json" onchange="loadTableKey(event)">
            </div>

            <button onclick="closeConfigModal()" class="hover:text-primary mt-8 text-sm bg-transparent border-none" style="color: var(--color-text-secondary);">Fechar</button>
        </div>
    </div>
    
<script src="pm/script_pm.js"></script>
</body>
</html>